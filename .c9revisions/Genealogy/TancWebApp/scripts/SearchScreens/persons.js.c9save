{"ts":1354536521167,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿\n$(document).ready(function () {\n    var jsMaster = new JSMaster();\n    var ancPersons = new AncPersons();\n\n    jsMaster.generateHeader('#1', function () {\n        ancPersons.init();\n\n    });\n\n});\n\n\nvar AncPersons = function () {\n    this.qryStrUtils = new QryStrUtils();\n    this.ancUtils = new AncUtils();\n    this.selection = new Array();\n    this.parishId = '';\n\n    this.postParams = {\n        url: '',\n        data: '',\n        idparam: undefined,\n        refreshmethod: this.getPersons,\n        refreshArgs: ['1'],\n        Context: this\n    };\n}\n\n\n\nAncPersons.prototype = {\n\n    init: function () {\n        var isActive = this.qryStrUtils.getParameterByName('active', '');\n\n\n        var panels = new Panels();\n\n        $(\"#main\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('1'); return false; }, panels));\n        $(\"#more\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('2'); return false; }, panels));\n        $(\"#refresh\").live(\"click\", $.proxy(function () { this.getPersons(\"0\"); return false; }, this));\n        $(\"#add\").live(\"click\", $.proxy(function () { this.addPerson('00000000-0000-0000-0000-000000000000'); return false; }, this));\n        $(\"#delete\").live(\"click\", $.proxy(function () { this.DeleteRecord(); return false; }, this));\n        $(\"#print\").live(\"click\", $.proxy(function () { this.PrintableResults(); return false; }, this));\n        $(\"#asslocs\").live(\"click\", $.proxy(function () { this.AssignLocations(); return false; }, this));\n        $(\"#dupes\").live(\"click\", $.proxy(function () { this.SetDuplicates(); return false; }, this));\n        $(\"#upests\").live(\"click\", $.proxy(function () { this.UpdateEstimates(); return false; }, this));\n        $(\"#sfat\").live(\"click\", $.proxy(function () { this.SetRelation('2'); return false; }, this));\n        $(\"#smot\").live(\"click\", $.proxy(function () { this.SetRelation('4'); return false; }, this));\n        $(\"#sson\").live(\"click\", $.proxy(function () { this.SetRelation('3'); return false; }, this));\n        $(\"#remove\").live(\"click\", $.proxy(function () { this.SetRemoveLink(); return false; }, this));\n        $(\"#merge\").live(\"click\", $.proxy(function () { this.SetMergeSources(); return false; }, this));\n        $(\"#sdau\").live(\"click\", $.proxy(function () { this.SetRelation('5'); return false; }, this));\n        $(\"#sbro\").live(\"click\", $.proxy(function () { this.SetRelation('6'); return false; }, this));\n        $(\"#ssis\").live(\"click\", $.proxy(function () { this.SetRelation('7'); return false; }, this));\n\n        $(\"#sbint\").live(\"click\", $.proxy(function () { this.sort('BirthInt'); return false; }, this));\n        $(\"#sdint\").live(\"click\", $.proxy(function () { this.sort('DeathInt'); return false; }, this));\n\n        $(\"#sbloc\").live(\"click\", $.proxy(function () { this.sort('BirthLocation'); return false; }, this));\n        $(\"#sname\").live(\"click\", $.proxy(function () { this.sort('ChristianName'); return false; }, this));\n\n        $(\"#ssurname\").live(\"click\", $.proxy(function () { this.sort('Surname'); return false; }, this));\n\n        $(\"#sfather\").live(\"click\", $.proxy(function () { this.sort('FatherChristianName'); return false; }, this));\n        $(\"#smother\").live(\"click\", $.proxy(function () { this.sort('MotherChristianName'); return false; }, this));\n        $(\"#sdloc\").live(\"click\", $.proxy(function () { this.sort('DeathLocation'); return false; }, this));\n\n\n        if (isActive == '1') {\n            $('#txtCName').val(this.qryStrUtils.getParameterByName('cname', ''));\n            $('#txtSName').val(this.qryStrUtils.getParameterByName('sname', ''));\n            $('#txtFCName').val(this.qryStrUtils.getParameterByName('fcname', ''));\n            $('#txtFSName').val(this.qryStrUtils.getParameterByName('fsname', ''));\n            $('#txtMCName').val(this.qryStrUtils.getParameterByName('mcname', ''));\n            $('#txtMSName').val(this.qryStrUtils.getParameterByName('msname', ''));\n            $('#txtLocation').val(this.qryStrUtils.getParameterByName('locat', ''));\n            $('#txtCounty').val(this.qryStrUtils.getParameterByName('count', ''));\n            $('#txtLowerDateRangeLower').val(this.qryStrUtils.getParameterByName('ldrl', ''));\n            $('#txtLowerDateRangeUpper').val(this.qryStrUtils.getParameterByName('ldru', ''));\n\n            if (this.qryStrUtils.getParameterByName('inct', '') == 'false') {\n                $('#chkIncludeTree').prop('checked', false);\n            }\n            else {\n                $('#chkIncludeTree').prop('checked', true);\n            }\n\n\n            if (this.qryStrUtils.getParameterByName('incb', '') == 'false') {\n                $('#chkIncludeBirths').prop('checked', false);\n            }\n            else {\n                $('#chkIncludeBirths').prop('checked', true);\n            }\n\n\n            if (this.qryStrUtils.getParameterByName('incd', '') == 'false') {\n                $('#chkIncludeDeaths').prop('checked', false);\n            }\n            else {\n                $('#chkIncludeDeaths').prop('checked', true);\n            }\n\n            this.parishId = this.qryStrUtils.getParameterByName('parid', '');\n\n            this.getPersons('1');\n        }\n\n    },\n    createQryString: function () {\n\n        var args = {\n            \"active\": '1',\n            \"cname\": $('#txtCName'),\n            \"sname\": $('#txtSName'),\n            \"fcname\": $('#txtFCName'),\n            \"fsname\": $('#txtFSName'),\n            \"mcname\": $('#txtMCName'),\n            \"msname\": $('#txtMSName'),\n            \"locat\": $('#txtLocation'),\n            \"count\": $('#txtCounty'),\n            \"ldrl\": $('#txtLowerDateRangeLower'),\n            \"ldru\": $('#txtLowerDateRangeUpper'),\n            \"inct\": $('#txtLocation').prop('checked'),\n            \"incb\": $('#txtLowerDateRangeLower').prop('checked'),\n            \"incd\": $('#txtLowerDateRangeUpper').prop('checked'),\n            \"parid\": this.parishId\n        };\n\n\n        this.qryStrUtils.updateQry(args);\n    },\n\n    getPersons: function (showdupes) {\n\n        var params = {};\n        var parentId = '';\n\n        if (showdupes == '0') {\n            this.qryStrUtils.updateQryPar('_parentId', parentId);\n        }\n        else {\n            parentId = this.qryStrUtils.getParameterByName('_parentId', '');\n        }\n\n        params[0] = parentId;\n        params[1] = String($('#txtCName').val());\n        params[2] = String($('#txtSName').val());\n        params[3] = String($('#txtFCName').val());\n        params[4] = String($('#txtFSName').val());\n        params[5] = String($('#txtMCName').val());\n        params[6] = String($('#txtMSName').val());\n\n        params[7] = String($('#txtLocation').val());\n        params[8] = String($('#txtCounty').val());\n\n        params[9] = String($('#txtLowerDateRangeLower').val());\n        params[10] = String($('#txtLowerDateRangeUpper').val());\n\n        params[11] = String($('#chkIncludeTree').prop('checked'));\n        params[12] = String($('#chkIncludeBirths').prop('checked'));\n        params[13] = String($('#chkIncludeDeaths').prop('checked'));\n        params[14] = '';\n        params[15] = String($('#txtSpouse').val());\n        params[16] = this.parishId;\n        params[17] = String(this.qryStrUtils.getParameterByName('page', 0));\n        params[18] = '30';\n        params[19] = String(this.qryStrUtils.getParameterByName('sort_col', 'BirthInt'));\n\n        this.ancUtils.twaGetJSON('/GetPersons/Select', params, $.proxy(this.processData, this));\n\n        this.createQryString();\n\n        return false;\n    },\n\n    processData: function (data) {\n\n        var tableBody = '';\n        var visibleRecords = new Array();\n        var dupeEvents = new Array();\n        var selectEvents = new Array();\n        var _idx = 0;\n        var that = this;\n\n\n        $.each(data.servicePersons, function (source, sourceInfo) {\n\n            var hidPID = '<input type=\"hidden\" name=\"person_id\" id=\"person_id\" value =\"' + sourceInfo.PersonId + '\"/>';\n            var hidParID = '<input type=\"hidden\" name=\"parent_id\" id=\"parent_id\" value =\"' + sourceInfo.XREF + '\"/>';\n\n            var arIdx = jQuery.inArray(sourceInfo.PersonId, that.selection);\n\n            if (arIdx >= 0) {\n                tableBody += '<tr class = \"highLightRow\">' + hidPID + hidParID;\n            }\n            else {\n                tableBody += '<tr>' + hidPID + hidParID;\n            }\n\n            var _loc = window.location.hash;\n            _loc = that.qryStrUtils.updateStrForQry(_loc, 'id', sourceInfo.PersonId);\n\n            tableBody += '<td><a id= \"d' + _idx + '\" href=\"\"><div>' + sourceInfo.Events + '</div></a></td>';\n            dupeEvents.push({ key: 'd' + _idx, value: sourceInfo.XREF });\n\n\n            tableBody += '<td><a href=\"../HtmlPages/PersonEditor.html' + _loc + '\"><div> Edit </div></a></td>';\n            tableBody += '<td><div class = \"dates\" >' + sourceInfo.BirthYear + '-' + sourceInfo.DeathYear + '</div></td>';\n\n            tableBody += '<td><div>' + sourceInfo.BirthLocation + '</div></td>';\n\n            tableBody += '<td><a id= \"s' + _idx + '\" href=\"\" ><div>' + sourceInfo.ChristianName + '</div></a></td>';\n            selectEvents.push({ key: 's' + _idx, value: sourceInfo.PersonId });\n\n            tableBody += '<td><div>' + sourceInfo.Surname + '</div></td>';\n\n            if (sourceInfo.Spouse == '')\n                tableBody += '<td><div class = \"parent\">' + sourceInfo.FatherChristianName + '</div></td>';\n            else\n                tableBody += '<td><div class = \"spouse\">' + sourceInfo.Spouse + '</div></td>';\n\n\n            tableBody += '<td><div>' + sourceInfo.MotherChristianName + '</div></td>';\n            tableBody += '<td><div>' + sourceInfo.MotherSurname + '</div></td>';\n            tableBody += '<td><div>' + sourceInfo.DeathLocation + '</div></td>';\n\n            tableBody += '</tr>';\n\n            visibleRecords.push(sourceInfo.PersonId);\n            _idx++;\n        });\n\n        if (this.selection != undefined) {\n            this.selection = this.selection.RemoveInvalid(visibleRecords);\n        }\n\n        if (tableBody != '') {\n\n            $('#search_bdy').html(tableBody);\n\n            //create pager based on results\n            var pagerparams = { ParentElement: 'pager',\n                Batch: data.Batch,\n                BatchLength: data.BatchLength,\n                Total: data.Total,\n                Function: this.getLink,\n                Context: this\n            };\n\n            this.ancUtils.createpager(pagerparams);\n\n            $('#reccount').html(data.Total + ' Persons');\n\n\n        }\n        else {\n            $('#search_bdy').html(tableBody);\n            $('#reccount').html('0 Persons');\n        }\n\n\n        this.ancUtils.addlinks(dupeEvents, this.loadDupes, this);\n\n        this.ancUtils.addlinks(selectEvents, this.processSelect, this);\n    },\n    loadDupes: function (id) {\n        this.ancUtils.updateQryPar('_parentId', id);\n        this.getPersons('1');\n    },\n    processSelect: function (evt) {\n        this.ancUtils.handleSelection(evt, this.selection, '#search_bdy tr', \"#person_id\");\n    },\n    getLink: function (toPage) {\n        this.qryStrUtils.updateQryPar('page', toPage);\n        this.getPersons('1');\n    },\n    sort: function (sort_col) {\n        this.ancUtils.sort_inner(sort_col);\n        this.getPersons('1');\n    },\n    addPerson: function (path) {\n        window.location.href = '../HtmlPages/PersonEditor.html#' + this.qryStrUtils.makeIdQryString('id', path);\n    },\n\n    DeleteRecord: function () {\n        this.postParams.url = '/Person/Delete';\n        this.postParams.data = { personId: this.ancUtils.convertToCSV(this.selection) };\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    PrintableResult: function () {\n\n    },\n    AssignLocations: function () {\n        this.postParams.url = '/Person/AssignLocats';\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    SetDuplicates: function () {\n        this.postParams.url = '/Person/SetDuplicate';\n        this.postParams.data = { persons: this.ancUtils.convertToCSV(this.selection) };\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    UpdateEstimates: function () {\n        this.ancUtils.twaGetJSON('/Person/UpdateDates', '', function () { });\n    },\n    SetRelation: function (relationid) {\n        this.postParams.url = '/Person/SetDuplicate';\n        this.postParams.data = { persons: this.ancUtils.convertToCSV(this.selection), relationType: relationid };\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    SetRemoveLink: function () {\n        this.postParams.url = '/Person/RemoveLinks';\n        this.postParams.data = { person: this.ancUtils.convertToCSV(this.selection)};\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    SetMergeSources: function(){\n        this.postParams.url = '/Person/MergePersons';\n        this.postParams.data = { person: this.ancUtils.convertToCSV(this.selection) };\n        this.ancUtils.twaPostJSON(this.postParams);\n    }\n\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]],"start1":0,"start2":0,"length1":0,"length2":12962}]],"length":12962}
{"contributors":[],"silentsave":false,"ts":1354536559410,"patch":[[{"diffs":[[-1,"﻿"],[1,"var JSMaster,QryStrUtils,AncUtils,Panels;\n\n\n"],[0,"\n$(d"]],"start1":0,"start2":0,"length1":5,"length2":48},{"diffs":[[0,"ction = "],[-1,"new Array()"],[1,"[]"],[0,";\n    th"]],"start1":365,"start2":365,"length1":27,"length2":18},{"diffs":[[0,"    };\n}"],[1,";"],[0,"\n\n\n\nAncP"]],"start1":579,"start2":579,"length1":16,"length2":17}]],"length":12997,"saved":false}
{"ts":1354536601551,"patch":[[{"diffs":[[0,"leRecords = "],[-1,"new Array()"],[1,"[]"],[0,";\n        va"]],"start1":7629,"start2":7629,"length1":35,"length2":26},{"diffs":[[0,"upeEvents = "],[-1,"new Array()"],[1,"[]"],[0,";\n        va"]],"start1":7658,"start2":7658,"length1":35,"length2":26},{"diffs":[[0,"s = "],[-1,"new Array()"],[1,"[]"],[0,";\n  "]],"start1":7697,"start2":7697,"length1":19,"length2":10},{"diffs":[[0,"pouse =="],[1,"="],[0," '')\n   "]],"start1":9292,"start2":9292,"length1":16,"length2":17},{"diffs":[[0,"ction !="],[1,"="],[0," undefin"]],"start1":9921,"start2":9921,"length1":16,"length2":17},{"diffs":[[0,"eBody !="],[1,"="],[0," '') {\n\n"]],"start1":10046,"start2":10046,"length1":16,"length2":17},{"diffs":[[0,"   }\n\n\n}"],[1,";"],[0,"\n\n\n\n\n\n\n\n"]],"start1":12948,"start2":12948,"length1":16,"length2":17}]],"length":12974,"saved":false}
