{"ts":1354550447779,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿\n$(document).ready(function () {\n    var jsMaster = new JSMaster();\n    var ancParishs = new AncParishs();\n    jsMaster.generateHeader('#1', function () {\n        ancParishs.init();\n    });\n});\n\n\nvar AncParishs = function () {\n    this.qryStrUtils = new QryStrUtils();\n    this.ancUtils = new AncUtils();\n    this.selection = new Array();\n  \n    this.postParams = {\n        url: '',\n        data: '',\n        idparam: undefined,\n        refreshmethod: this.getParishs,\n        refreshArgs: ['1'],\n        Context: this\n    };\n}\n\n\n\nAncParishs.prototype = {\n\n    init: function () {\n        var isActive = this.qryStrUtils.getParameterByName('active', '');\n\n        var panels = new Panels();\n\n        $(\"#main\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('1'); return false; }, panels));\n        $(\"#more\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('2'); return false; }, panels));     \n        $(\"#refresh\").live(\"click\", $.proxy(function () { this.getParishs(); return false; }, this));\n\n\n        $(\"#add\").live(\"click\", $.proxy(function () { this.AddParish(); return false; }, this));\n        $(\"#delete\").live(\"click\", $.proxy(function () { this.DeleteRecord(); return false; }, this));\n        $(\"#select_return\").live(\"click\", $.proxy(function () { this.returnselection(); return false; }, this));\n\n        $(\"#pname\").live(\"click\", $.proxy(function () { this.sort(\"ParishName\"); return false; }, this));\n        $(\"#pdeposited\").live(\"click\", $.proxy(function () { this.sort(\"ParishDeposited\"); return false; }, this));\n        $(\"#pparent\").live(\"click\", $.proxy(function () { this.sort(\"ParishParent\"); return false; }, this));\n        $(\"#pstartyear\").live(\"click\", $.proxy(function () { this.sort(\"ParishStartYear\"); return false; }, this));\n        $(\"#pendyear\").live(\"click\", $.proxy(function () { this.sort(\"ParishEndYear\"); return false; }, this));\n        $(\"#pcounty\").live(\"click\", $.proxy(function () { this.sort(\"ParishCounty\"); return false; }, this));\n\n        if (isActive == '1') {\n            $('#txtDeposited').val(this.qryStrUtils.getParameterByName('dep', ''));\n            $('#txtName').val(this.qryStrUtils.getParameterByName('name', ''));\n            $('#txtCounty').val(this.qryStrUtils.getParameterByName('count', ''));\n\n            this.getParishs('1');\n        }\n\n\n        var isPersonImpSelection = this.qryStrUtils.getParameterByName('parl', '');\n\n        if (isPersonImpSelection != null) {\n            $(\"#rLink\").removeClass(\"hidePanel\").addClass(\"displayPanel\");\n        }\n        else {\n            $(\"#rLink\").addClass(\"hidePanel\").removeClass(\"displayPanel\");\n        }\n\n    },\n    returnselection: function () {\n\n        var parl = this.qryStrUtils.getParameterByName('parl', '');\n        var parishLst = '';\n\n        $.each(selection, function (idx, val) {\n            if (idx > 0) {\n                parishLst += ',' + val;\n            }\n            else {\n                parishLst += val;\n            }\n        });\n\n        this.qryStrUtils.updateQryPar('parl', parishLst);\n\n        var sources = this.qryStrUtils.getParameterByName('scs', '');\n        //dont lose these if they are there.\n        var parishs = this.qryStrUtils.getParameterByName('parl', '');\n\n        var _loc = '#?scs=' + sources + '&parl=' + parishs;\n\n        var url = '../HtmlPages/batchEntry.html' + _loc;\n\n        window.location.href = url;\n    },\n    createQryString: function (page) {\n\n        var args = {\n            \"active\": '1',\n            \"dep\": $('#txtDeposited'),\n            \"name\": $('#txtName'),\n            \"count\": $('#txtCounty')\n        };\n\n        this.qryStrUtils.updateQry(args);\n\n    },\n    getParishs: function () {\n\n        var params = {};\n\n        params[0] = String($('#txtDeposited').val());\n        params[1] = String($('#txtName').val());\n        params[2] = String($('#txtCounty').val());\n        params[3] = String(this.qryStrUtils.getParameterByName('page', 0));\n        params[4] = '30';\n        params[5] = String(this.qryStrUtils.getParameterByName('sort_col', 'ParishName'));\n\n        this.ancUtils.twaGetJSON('/Parishs/GetParishs/Select', params, $.proxy(this.processData, this));\n\n        this.createQryString(page);\n\n        return false;\n    },\n    processData: function (data) {\n        //alert('received something');\n        var tableBody = '';\n        var selectEvents = new Array();\n        var _idx = 0;\n        var that = this;\n\n\n        $.each(data.serviceParishs, function (source, sourceInfo) {\n\n            var hidPID = '<input type=\"hidden\" name=\"ParishId\" id=\"ParishId\" value =\"' + sourceInfo.ParishId + '\"/>';\n            var arIdx = jQuery.inArray(sourceInfo.ParishId, selection);\n\n            if (arIdx >= 0) {\n                tableBody += '<tr class = \"highLightRow\">' + hidPID + hidParID;\n            }\n            else {\n                tableBody += '<tr>' + hidPID;\n            }\n\n            var _loc = window.location.hash;\n            _loc = that.qryStrUtils.updateStrForQry(_loc, 'id', sourceInfo.ParishId);\n\n            tableBody += '<td><a id= \"s' + _idx + '\" href=\"\" ><div>' + sourceInfo.ParishName + '</div></a></td>';\n            selectEvents.push({ key: 's' + _idx, value: sourceInfo.ParishId });\n\n            tableBody += '<td><div>' + sourceInfo.ParishDeposited + '</div></td>';\n            tableBody += '<td><a href=\"../HtmlPages/ParishEditor.html' + _loc + '\"><div> Edit </div></a></td>';\n            tableBody += '<td><div>' + sourceInfo.ParishParent + '</div></td>';\n            tableBody += '<td><div>' + sourceInfo.ParishStartYear + '</div></td>';\n            tableBody += '<td><div>' + sourceInfo.ParishEndYear + '</div></td>';\n            tableBody += '<td><div>' + sourceInfo.ParishCounty + '</div></td>';\n\n            tableBody += '</tr>';\n            _idx++;\n        });\n\n        if (tableBody != '') {\n\n            $('#search_bdy').html(tableBody);\n            //create pager based on results\n\n            var pagerparams = { ParentElement: 'pager',\n                Batch: data.Batch,\n                BatchLength: data.BatchLength,\n                Total: data.Total,\n                Function: this.getLink,\n                Context: this\n            };\n\n            this.ancUtils.createpager(pagerparams);\n\n            // $('#pager').html(createpager(data.Batch, data.BatchLength, data.Total, 'getLink'));\n\n            $('#reccount').html(data.Total + ' Parishs');\n        }\n        else {\n\n            $('#search_bdy').html(tableBody);\n            $('#reccount').html('0 Parishs');\n        }\n\n        this.ancUtils.addlinks(selectEvents, this.processSelect, this);\n    },\n    processSelect: function (evt) {\n        this.ancUtils.handleSelection(evt, this.selection, '#search_bdy tr', \"#ParishId\");\n    },\n    sort: function (sort_col) {\n        this.ancUtils.sort_inner(sort_col);\n        this.getParishs('1');\n    },\n    getLink: function (toPage) {\n        this.qryStrUtils.updateQryPar('page', toPage);\n        this.getParishs('1');\n    },\n    DeleteRecord: function () {\n        this.postParams.url = '/Parishs/Delete';\n        this.postParams.data = { parishIds: this.ancUtils.convertToCSV(this.selection) };\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    AddParish: function () {\n        window.location.href = '../HtmlPages/ParishEditor.html#' + this.qryStrUtils.makeIdQryString('id', '00000000-0000-0000-0000-000000000000');\n    }\n}\n\n\n\n "]],"start1":0,"start2":0,"length1":0,"length2":7406}]],"length":7406}
{"contributors":[],"silentsave":false,"ts":1354550597765,"patch":[[{"diffs":[[-1,"﻿"],[1,"var JSMaster, QryStrUtils, AncUtils,Panels;\n\n"],[0,"\n$(d"]],"start1":0,"start2":0,"length1":5,"length2":49},{"diffs":[[0,"ction = "],[-1,"new Array()"],[1,"[]"],[0,";\n  \n   "]],"start1":363,"start2":363,"length1":27,"length2":18},{"diffs":[[0,"    };\n}"],[-1,""],[0,""],[1,";"],[0,"\n\n\n\nAncP"]],"start1":555,"start2":555,"length1":16,"length2":17},{"diffs":[[0,"ction !="],[-1,""],[0,""],[1,"="],[0," null) {"]],"start1":2484,"start2":2484,"length1":16,"length2":17},{"diffs":[[0," {\n\n        "],[1,"//"],[0,"var parl = t"]],"start1":2727,"start2":2727,"length1":24,"length2":26},{"diffs":[[0," $.each("],[1,"this."],[0,"selectio"]],"start1":2837,"start2":2837,"length1":16,"length2":21},{"diffs":[[0,"nction ("],[-1,"page"],[0,""],[1,""],[0,") {\n\n   "]],"start1":3475,"start2":3475,"length1":20,"length2":16},{"diffs":[[0,"yString("],[-1,"page"],[0,""],[1,""],[0,");\n\n    "]],"start1":4241,"start2":4241,"length1":20,"length2":16},{"diffs":[[0,"s = "],[-1,"new Array()"],[1,"[]"],[0,";\n  "]],"start1":4407,"start2":4407,"length1":19,"length2":10},{"diffs":[[0,"rishId, "],[1,"this."],[0,"selectio"]],"start1":4703,"start2":4703,"length1":16,"length2":21},{"diffs":[[0,"+ hidPID"],[1,";//"],[0," + hidPa"]],"start1":4818,"start2":4818,"length1":16,"length2":19},{"diffs":[[0,"eBody !="],[-1,""],[0,""],[1,"="],[0," '') {\n\n"]],"start1":5866,"start2":5866,"length1":16,"length2":17},{"diffs":[[0,"\n    }\n}"],[-1,""],[0,""],[1,";"],[0,"\n\n\n\n "]],"start1":7429,"start2":7429,"length1":13,"length2":14}]],"length":7443,"saved":false}
