{"ts":1355143795542,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"ï»¿//var setDefaultPersonUrl = getHost() + \"/settreepersons/Set\";\n//var saveSourceUrl = getHost() + \"/SaveTree/Save\";\n\n//var deleteSourceUrl = getHost() + \"/Source/Delete\";\n\n\n$(document).ready(function () {\n    var jsMaster = new JSMaster();\n    var ancSources = new AncSources();\n\n    jsMaster.generateHeader('#1', function () {\n        ancSources.init();\n\n    });\n\n});\n\n\nvar AncSources = function () {\n    this.qryStrUtils = new QryStrUtils();\n    this.ancUtils = new AncUtils();\n    this.selection = new Array();\n    this.parishId = '';\n\n    this.postParams = { \n        url: '',\n        data: '',\n        idparam: undefined,\n        refreshmethod: this.getSources,\n        refreshArgs: ['1'],\n        Context: this\n    };\n \n}\n\nAncSources.prototype = {\n\n    init: function () {\n\n\n        var isActive = this.qryStrUtils.getParameterByName('active');\n\n        var panels = new Panels();\n\n        $(\"#main\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('1'); return false; }, panels));\n        $(\"#more\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('2'); return false; }, panels));\n        $(\"#additional\").live(\"click\", $.proxy(function () { panels.sourcesShowPanel('3'); return false; }, panels));\n        $(\"#refresh\").live(\"click\", $.proxy(function () { this.getSources(); return false; }, this));\n\n\n        $(\"#add\").live(\"click\", $.proxy(function () { this.addSource('00000000-0000-0000-0000-000000000000'); return false; }, this));\n        $(\"#delete\").live(\"click\", $.proxy(function () { this.deleteSources(); return false; }, this));\n        $(\"#print\").live(\"click\", $.proxy(function () { this.printableSources(); return false; }, this));\n        $(\"#select_return\").live(\"click\", $.proxy(function () { this.returnselection(); return false; }, this));\n\n        $(\"#sdate\").live(\"click\", $.proxy(function () { this.sort(\"SourceDate\"); return false; }, this));\n        $(\"#sref\").live(\"click\", $.proxy(function () { this.sort(\"SourceRef\"); return false; }, this));\n        $(\"#sdesc\").live(\"click\", $.proxy(function () { this.sort(\"SourceDescription\"); return false; }, this));\n\n\n\n        if (isActive == '1') {\n\n            $('#txtSourceRef').val(this.qryStrUtils.getParameterByName('sref', ''));\n            $('#txtSourceDescription').val(this.qryStrUtils.getParameterByName('sdesc', ''));\n            $('#txtOriginalLocation').val(this.qryStrUtils.getParameterByName('origLoc', ''));\n\n            $('#txtLowerDateRangeLower').val(this.qryStrUtils.getParameterByName('ldrl', ''));\n            $('#txtLowerDateRangeUpper').val(this.qryStrUtils.getParameterByName('ldru', ''));\n            $('#txtUpperDateRangeLower').val(this.qryStrUtils.getParameterByName('udrl', ''));\n            $('#txtUpperDateRangeUpper').val(this.qryStrUtils.getParameterByName('udru', ''));\n\n            $('#txtCountNo').val(this.qryStrUtils.getParameterByName('fcount', ''));\n            $('#chkIsThackrayFound').val(this.qryStrUtils.getParameterByName('ist', ''));\n            $('#chkIsCopyHeld').val(this.qryStrUtils.getParameterByName('isc', ''));\n            $('#chkIsViewed').val(this.qryStrUtils.getParameterByName('isv', ''));\n            $('#chkUseOptions').val(this.qryStrUtils.getParameterByName('isuo', ''));\n\n\n            this.getSources();\n        }\n\n\n\n        var sourceTypeLookup = new SourceTypeLookup();\n        sourceTypeLookup.init();\n\n        var isPersonImpSelection = this.qryStrUtils.getParameterByName('scs', '');\n\n        if (isPersonImpSelection != null) {\n            $(\"#rLink\").removeClass(\"hidePanel\").addClass(\"displayPanel\");\n        }\n        else {\n            $(\"#rLink\").addClass(\"hidePanel\").removeClass(\"displayPanel\");\n        }\n\n    }\n    ,\n    getSources: function () {\n\n        var params = {};\n        params[0] = this.qryStrUtils.getParameterByName('stids', '');\n        params[1] = $('#txtSourceRef').val();\n        params[2] = $('#txtSourceDescription').val();\n        params[3] = $('#txtOriginalLocation').val();\n        params[4] = $('#txtLowerDateRangeLower').val();\n        params[5] = $('#txtLowerDateRangeUpper').val();\n        params[6] = $('#txtUpperDateRangeLower').val();\n        params[7] = $('#txtUpperDateRangeUpper').val();\n        params[8] = $('#txtCountNo').val();\n        params[9] = 'false'; // $('#chkIsThackrayFound').val();\n        params[10] = 'false'; // $('#chkIsCopyHeld').val();\n        params[11] = 'false'; // $('#chkIsViewed').val();\n        params[12] = 'false'; // $('#chkUseOptions').val();\n        params[13] = String(this.qryStrUtils.getParameterByName('page', 0));\n        params[14] = '30';\n        params[15] = this.qryStrUtils.getParameterByName('sort_col', 'sdate');\n    \n        this.ancUtils.twaGetJSON('/GetSources/Select', params, $.proxy(this.processData, this));\n\n        this.createQryString();\n        return false;\n    },\n\n    returnselection: function () {\n\n        var parishLst = '';\n\n        $.each(this.selection, function (idx, val) {\n            if (idx > 0) {\n                parishLst += ',' + val;\n            }\n            else {\n                parishLst += val;\n            }\n        });\n\n        this.qryStrUtils.updateQryPar('scs', parishLst);\n\n        var sources = this.qryStrUtils.getParameterByName('scs', '');\n        //dont lose these if they are there.\n        var parishs = this.qryStrUtils.getParameterByName('parl', '');\n\n        var _loc = '#?scs=' + sources + '&parl=' + parishs;\n\n        var url = '../HtmlPages/batchEntry.html' + _loc;\n\n        window.location.href = url;\n    },\n\n\n    createQryString: function () {\n\n        var args = {\n            \"active\": '1',\n            \"sref\": $('#txtSourceRef'),\n            \"sdesc\": $('#txtSourceDescription'),\n            \"origLoc\": $('#txtOriginalLocation'),\n            \"ldrl\": $('#txtLowerDateRangeLower'),\n            \"ldru\": $('#txtLowerDateRangeUpper'),\n            \"udrl\": $('#txtUpperDateRangeLower'),\n            \"udru\": $('#txtUpperDateRangeUpper'),\n            \"fcount\": $('#txtCountNo')\n        };\n\n        this.qryStrUtils.updateQry(args);\n\n    },\n\n    //// this can find out what page its on based on the\n    //// returned data.\n    processData: function (data) {\n        //alert('received something');\n        var tableBody = '';\n        var selectEvents = new Array();\n        var _idx = 0;\n        var that = this;\n\n\n        $.each(data.serviceSources, function (source, sourceInfo) {\n            //<a href='' class=\"button\" ><span>Main</span></a>\n            var hidfield = '<input type=\"hidden\" name=\"source_id\" id=\"source_id\" value =\"' + sourceInfo.SourceId + '\"/>';\n\n            tableBody += '<tr>' + hidfield;\n            tableBody += '<td><div>' + sourceInfo.SourceYear + '</div></td>';\n            tableBody += '<td><div>' + sourceInfo.SourceYearTo + '</div></td>';\n\n            var _loc = window.location.hash;\n            _loc = that.qryStrUtils.updateStrForQry(_loc, 'id', sourceInfo.SourceId);\n\n            tableBody += '<td><a href=\"../HtmlPages/SourceEditor.html' + _loc + '\"><div> Edit </div></a></td>';\n\n            tableBody += '<td class = \"sourceref\" ><a  id= \"s' + _idx + '\" href=\"\" ><div title=\"' + sourceInfo.SourceRef + '\">' + sourceInfo.SourceRef + '</div></a></td>';\n\n            selectEvents.push({ key: 's' + _idx, value: sourceInfo.SourceId });\n\n            tableBody += '<td class = \"source_d\" ><div  title=\"' + sourceInfo.SourceDesc + '\">' + sourceInfo.SourceDesc + '</div></td>';\n\n            tableBody += '</tr>';\n            _idx++;\n\n        });\n\n        if (tableBody != '') {\n\n            $('#search_bdy').html(tableBody);\n\n            //create pager based on results\n\n            $('#reccount').html(data.Total + ' Sources');\n\n            // $('#pager').html(createpager(data.Batch, data.BatchLength, data.Total, 'getLink'));\n\n            var pagerparams = { ParentElement: 'pager',\n                Batch: data.Batch,\n                BatchLength: data.BatchLength,\n                Total: data.Total,\n                Function: this.getLink,\n                Context: this\n            };\n\n            this.ancUtils.createpager(pagerparams);\n        }\n        else {\n            $('#search_bdy').html(tableBody);\n            $('#reccount').html('0 Sources');\n        }\n\n\n        this.ancUtils.addlinks(selectEvents, this.processSelect, this);\n    },\n    processSelect: function (evt) {\n        this.ancUtils.handleSelection(evt, this.selection, '#search_bdy tr', \"#source_id\");\n    },\n    sort: function (sort_col) {\n        this.ancUtils.sort_inner(sort_col);\n        this.getSources();\n    },\n    getLink: function (toPage) {\n        this.qryStrUtils.updateQryPar('page', toPage);\n        this.getSources();\n    },\n    addSource: function (path) {\n        window.location.href = '../HtmlPages/SourceEditor.html#' + this.qryStrUtils.makeIdQryString('id', path);\n    },\n    deleteSources: function () {\n        this.postParams.url = '/Source/Delete';\n        this.postParams.data = { sourceId: this.ancUtils.convertToCSV(this.selection) };\n        this.ancUtils.twaPostJSON(this.postParams);\n    },\n    printableSources: function () {\n        //not implemented yet.\n    }\n\n}\n\n"]],"start1":0,"start2":0,"length1":0,"length2":9109}]],"length":9109}
{"ts":1355176878850,"patch":[[{"diffs":[[0,"s,Panels"],[1,",SourceTypeLookup"],[0,";\n"],[-1,""],[0,"\n//var s"]],"start1":33,"start2":33,"length1":18,"length2":35},{"diffs":[[0,"ction !="],[1,"="],[0," null) {"]],"start1":3534,"start2":3534,"length1":16,"length2":17},{"diffs":[[0,"s = "],[-1,"new Array()"],[1,"[]"],[0,";\n  "]],"start1":6306,"start2":6306,"length1":19,"length2":10},{"diffs":[[0,";\n\n        });\n\n"],[-1,""],[0,"        if (tabl"]],"start1":7509,"start2":7509,"length1":32,"length2":32},{"diffs":[[0,"eBody !="],[1,"="],[0," '') {\n\n"]],"start1":7541,"start2":7541,"length1":16,"length2":17}]],"length":9154,"saved":false}
