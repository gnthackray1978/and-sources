{"ts":1354035098967,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿\n//this.ancSelectorBase.context_data = {\n//    name: ''\n//    editorUrl: '../Forms/FrmEditSource.aspx',\n//    param_name: 'source_ids',\n//    selectionUrl: '/Sources/GetSourceNames',\n//    pagerfunction: undefined,   // this.pagerfunction = 'getLink';\n//    search_body: 'search_bdy',\n//    search_hed: 'search_hed',\n//    pager: 's_pager',\n//    sourceRefId: 'txtSourceRef',\n//    title: 'SOURCES',\n//    refreshMethod: this.getSources\n\n//};\n\n\nvar AncSelectorBase = function () {\n    this.qryStrUtils = new QryStrUtils();\n    this.ancUtils = new AncUtils();\n    this.selection = new Array();\n    this.context_data = {};\n\n}\n\nAncSelectorBase.prototype = {\n\n    createOutline: function (selectorid) {\n\n\n        var body = '';\n\n        body += '<div class = \"sf_shad sf_cont\">';\n\n        body += '<div class = \"sf_hed\"><div><b>' + this.context_data.title + '</b></div></div>';\n\n        body += '<div class = \"sf_pad-cont\">';\n        body += '<table border=\"0\">';\n        body += '<thead>';\n        body += '<tr class=\"tophed\">';\n        body += '<td><a href=\"../Default.aspx\" onclick = \"return false\" ><span>Ref</span></a></td>';\n        body += '<td></td>';\n        body += '</tr>';\n        body += '</thead>';\n\n        body += '<tbody id = \"' + this.context_data.search_hed + '\">';\n        body += '</tbody>';\n        body += '</table>';\n\n        body += '<br />';\n\n        body += '<div class = \"sf_bot\"><div><b>Select From</b></div></div>';\n\n        body += '<div class=\"sf_mid-lab\">';\n        body += '<div class=\"sf_mlab-dlef\">';\n        body += '<input id=\"' + this.context_data.sourceRefId + '\" class = \"sf_txt\" type=\"text\"/>';\n        body += '</div>';\n\n\n        body += '<div class=\"sf_mlab-drig\">';\n        body += '<a id= \"sb_refresh\" href=\"\" class=\"button\" ><span>R</span></a>';\n        body += '</div>';\n        body += '</div>';\n\n        body += '<br /><br />';\n\n        body += '<div style=\"overflow:auto;height:300px;\">';\n\n        body += '<table >'; //class=\"pink\"\n        body += '<thead>';\n        body += '<tr class=\"bothed\" >'; //class=\"hed\"\n        body += '<td><a href=\"../Default.aspx\" onclick = \"return false\" ><span>Ref</span></a></td>';\n        body += '<td></td>';\n        body += '</tr>';\n        body += '</thead>';\n        body += '<tbody id = \"' + this.context_data.search_body + '\">';\n        body += '</tbody>';\n        body += '</table>';\n\n        body += '</div>';\n\n\n        body += '<div class=\"fltbrow\">';\n        body += '<div id=\"' + this.context_data.pager + '\" class = \"pager\"></div>';\n\n        body += '</div>';\n\n        body += '</div>';\n\n        body += '</div>';\n\n        $(selectorid).html(body);\n\n\n        $(\"#sb_refresh\").live(\"click\", $.proxy(this.context_data.refreshMethod, this));\n\n\n    },\n\n\n    refreshSelected: function () {\n\n        var newSources = this.getNewSources();\n\n        if (newSources.length > 0) {\n            var params = {};\n            params[0] = convertToCSV(newSources);\n\n            var successmethod = function (data) {\n                var rows = new Array();\n                $.each(data, function (source, sourceInfo) {\n                    var row0 = { desc: sourceInfo };\n                    rows.push(row0);\n                });\n                this.addNewSelectedSources(data);\n            };\n\n            this.ancUtils.twaGetJSON(this.context_data.selectionUrl, params, $.proxy(successmethod, this));\n        }\n    },\n\n\n    addNewSelectedSources: function (data) {\n\n        var indexs = this.getNewSources();\n        var selectEvents = new Array();\n        var count = 0;\n        var selected_sourceId = null;\n\n        var tableBody = $('#' + this.context_data.search_hed).html();\n\n        var _idx = 0;\n\n        $.each(data, function (intIndex, objValue) {\n            if ($.isArray(indexs)) {\n                selected_sourceId = indexs[intIndex];\n            }\n            else {\n                selected_sourceId = indexs;\n            }\n\n            tableBody += '<tr id = \"' + selected_sourceId + '\" class=\"selected_source\" >'; //+ hidfield;\n            tableBody += '<td>' + objValue + '</td>';\n            tableBody += '<td><a id= \"sr' + _idx + '\" href=\"\"><div> Remove </div></a></td>';\n            selectEvents.push({ key: 'sr' + _idx, value: selected_sourceId });\n\n            tableBody += '</tr>';\n            _idx++;\n        });\n\n\n        $('#' + this.context_data.search_hed).html(tableBody);\n\n        this.ancUtils.addlinks(selectEvents, this.removeFromSelection, this);\n    },\n\n\n    removeFromSelection: function (sourceId) {\n\n        //sourceId, param_name\n\n        var selectedSourceIds = new Array();\n        var paramSources = this.qryStrUtils.getParameterByName(this.context_data.param_name);\n        if (paramSources != '' && paramSources != null) {\n            selectedSourceIds = paramSources.split(',');\n        }\n\n\n        if (selectedSourceIds != undefined) {\n\n            selectedSourceIds.splice(selectedSourceIds.indexOf(sourceId), 1);\n\n            $('#' + sourceId + '.selected_source').remove();\n\n            this.qryStrUtils.updateQryPar(this.context_data.param_name, convertToCSV(selectedSourceIds));\n        }\n\n    },\n\n    createBody: function (batch_data) {\n        var tableBody = '';\n        var selectEvents = new Array();\n        var _idx = 0;\n\n        var that = this;\n        $.each(\n                batch_data.rows,\n                function (intIndex, objValue) {\n                    var hidfield = '<input type=\"hidden\" name=\"source_id\" id=\"source_id\" value =\"' + objValue.id + '\"/>';\n                    tableBody += '<tr>' + hidfield;\n                    var _loc = window.location.hash + '&id=' + objValue.id;\n                    _loc = _loc.replace('#', '');\n\n                    tableBody += '<td><a href=\"' + that.context_data.editorUrl + _loc + '\"><div>' + objValue.ref + '</div></a></td>';\n                    tableBody += '<td><a id= \"cb' + _idx + '\" href=\"\" ><div> Add </div></a></td>';\n\n                    selectEvents.push({ key: 'cb' + _idx, value: objValue.id });\n\n                    tableBody += '</tr>';\n\n                    _idx++;\n                }\n\n\n        );\n\n        if (tableBody != '') {\n            $('#' + this.context_data.search_body).html(tableBody); //\n\n\n            //create pager based on results\n            var pagerparams = { ParentElement: this.context_data.pager,\n                Batch: batch_data.Batch,\n                BatchLength: batch_data.BatchLength,\n                Total: batch_data.Total,\n                Function: this.context_data.pagerfunction,\n                Context: this.context_data.parentContext\n            };\n\n            this.ancUtils.createpager(pagerparams);\n\n\n            // $('#' + pager).html(createpager(batch_data.Batch, batch_data.BatchLength, batch_data.Total, pagerLinkFunction));\n\n\n        }\n        else {\n            $('#' + this.context_data.search_body).html(tableBody); //'#search_bdy'         \n        }\n\n        this.ancUtils.addlinks(selectEvents, this.addToSelection, this);\n\n        this.refreshSelected();\n\n\n    },\n\n    addToSelection: function (sourceId) {\n        //sourceId, param_name, selectionUrl, search_hed\n        var selectedSourceIds = new Array();\n        //var param_name = 'source_ids';\n\n        var paramSources = this.qryStrUtils.getParameterByName(this.context_data.param_name);\n        if (paramSources != '' && paramSources != null) {\n            selectedSourceIds = paramSources.split(',');\n        }\n\n        if (selectedSourceIds != undefined) {\n\n            if (selectedSourceIds.indexOf(sourceId) == -1) {\n                selectedSourceIds.push(sourceId);\n            }\n\n            this.qryStrUtils.updateQryPar(this.context_data.param_name, convertToCSV(selectedSourceIds));\n        }\n\n        this.refreshSelected();\n    },\n\n    getNewSources: function () {\n\n        var refreshRequired = false;\n        var newSources = new Array();\n        var currentSources = new Array();\n\n        var paramSources = this.qryStrUtils.getParameterByName(this.context_data.param_name);\n\n        //existing sources selected\n        $('#' + this.context_data.search_hed + ' .selected_source').each(function () {\n            currentSources.push(this.id);\n        });\n\n        if (paramSources != '' && paramSources != null) {\n            //if we just have 1 source in the query string\n            if (paramSources.indexOf(',') == -1) {\n                // if the current sources on the form dont contain that source \n                // add it to the new sources list\n                if (currentSources.indexOf(paramSources) == -1) {\n                    newSources.push(paramSources);\n                }\n            } else {\n                //loop through each source in the query string\n                $.each(paramSources.split(','), function (key, val) {\n\n                    if (currentSources.indexOf(val) == -1) {\n\n                        newSources.push(val);\n                    }\n\n                });\n            }\n        }\n\n\n\n        return newSources;\n    }\n\n\n\n\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":8985}]],"length":8985}
{"contributors":[],"silentsave":false,"ts":1354035171230,"patch":[[{"diffs":[[-1,"﻿"],[1,"\n\n"],[0,"\n//t"]],"start1":0,"start2":0,"length1":5,"length2":6},{"diffs":[[0,"Sources\n"],[1,"// monkey"],[0,"\n//};\n\n\n"]],"start1":431,"start2":431,"length1":16,"length2":25}]],"length":8995,"saved":false}
{"ts":1354035347184,"patch":[[{"diffs":[[0,"a = {};\n"],[1,"    var test = '';\n    "],[0,"\n}\n\nAncS"]],"start1":624,"start2":624,"length1":16,"length2":39}]],"length":9018,"saved":false}
